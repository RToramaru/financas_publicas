<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KMeans com TensorFlow.js</title>
</head>
<body>
    <button id="runKMeansButton">Executar KMeans</button>

    <h2>Testar com Novos Valores</h2>
    <input type="number" id="input1" placeholder="Feature 1">
    <input type="number" id="input2" placeholder="Feature 2">
    <input type="number" id="input3" placeholder="Feature 3">
    <input type="number" id="input4" placeholder="Feature 4">
    <button id="predictButton">Fazer Previs√£o</button>
    <p id="predictionResult"></p>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script>
        let kmeansModel;

        async function runKMeans() {
            const response = await fetch('model.json');
            const modelData = await response.json();

            const nClusters = modelData.model_state.n_clusters;
            const clusterCenters = modelData.model_state.cluster_centers_;

            kmeansModel = {
                nClusters: nClusters,
                clusterCenters: clusterCenters
            };

            console.log('KMeans model loaded.');
        }

        async function predictCluster(input) {
            const distances = kmeansModel.clusterCenters.map(center =>
                tf.tidy(() => tf.sum(tf.square(tf.sub(tf.tensor(center), input))))
            );

            const closestClusterIndex = distances.reduce((prevIndex, distance, currentIndex) =>
                distance < distances[prevIndex] ? currentIndex : prevIndex, 0);

            return closestClusterIndex;
        }

        document.getElementById('runKMeansButton').addEventListener('click', () => {
            runKMeans();
        });

        document.getElementById('predictButton').addEventListener('click', async () => {
            const input1 = parseFloat(document.getElementById('input1').value);
            const input2 = parseFloat(document.getElementById('input2').value);
            const input3 = parseFloat(document.getElementById('input3').value);
            const input4 = parseFloat(document.getElementById('input4').value);

            const input = tf.tensor([input1, input2, input3, input4]);

            const predictedCluster = await predictCluster(input);
            document.getElementById('predictionResult').innerText = `Predicted Cluster: ${predictedCluster}`;
        });
    </script>
</body>
</html>
